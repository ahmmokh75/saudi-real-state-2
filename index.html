<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e3c72">
    <meta name="description" content="Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">
    <title>Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ù†Ø²Ù„ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</title>
    <link rel="manifest" href="manifest.json">
    <style>
        /* Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù‡Ù†Ø§ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #00a86b, #ff9900, #ff6b6b);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .project-info {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø®Ø±Ù‰ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ */
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00a86b;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .sync-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #2a5298;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 999;
        }
        
        .sync-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ff6b6b;
            color: white;
            text-align: center;
            padding: 10px;
            z-index: 1001;
            display: none;
        }
        
        .install-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            padding: 20px;
            max-width: 300px;
            z-index: 1000;
            display: none;
        }
        
        .install-prompt button {
            background: #2a5298;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
            width: 100%;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-width: 768px) {
            .install-prompt {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <!-- Ù…Ø¤Ø´Ø± Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ -->
    <div class="offline-indicator" id="offlineIndicator">
        âš ï¸ Ø£Ù†Øª ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ÙŠØªÙ… Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ.
    </div>
    
    <!-- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="notification" id="notification"></div>
    
    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
    <div class="sync-indicator" id="syncIndicator" style="display: none;">
        <div class="sync-spinner"></div>
        <span>Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div class="install-prompt" id="installPrompt">
        <h3>ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ù†Ø²Ù„</h3>
        <p>Ù‚Ù… Ø¨ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ ÙˆØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„.</p>
        <button id="installButton">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
        <button id="dismissInstall" style="background: #f0f0f0; color: #333; margin-top: 5px;">Ù„Ø§Ø­Ù‚Ù‹Ø§</button>
    </div>

    <div class="container">
        <header>
            <h1>Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ù†Ø²Ù„</h1>
            <p class="project-info">Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ù…Ø¯Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
        </header>
        
        <!-- Ù…Ø³Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="breadcrumb" id="breadcrumb">
            <div class="breadcrumb-item breadcrumb-current">Ø§Ù„Ù…Ø¯Ù†</div>
        </div>
        
        <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø¯Ù† -->
        <div id="citiesPage">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-value" id="totalCities">3</div>
                    <div class="stat-label">Ù…Ø¯ÙŠÙ†Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalProjects">19</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalApartments">169</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‚Ù‚</div>
                </div>
            </div>
            
            <h2 style="text-align: center; margin-bottom: 30px; color: #2a5298;">Ù…Ø¯Ù† Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h2>
            <div class="cities-grid" id="citiesContainer">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯Ù† Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
        <div id="projectGroupsPage" class="hidden">
            <button class="back-btn" id="backToCities">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ù†
            </button>
            
            <header>
                <h1 id="cityTitle">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø±ÙŠØ§Ø¶</h1>
                <p class="project-info" id="cityDetails">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø±ÙŠØ§Ø¶</p>
            </header>
            
            <div class="search-container">
                <input type="text" class="search-input" id="groupSearch" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹...">
                <select class="filter-select" id="groupFilter">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</option>
                    <option value="sly">SLY</option>
                    <option value="umh">UMH</option>
                    <option value="jed">JED</option>
                    <option value="dmm">DMM</option>
                </select>
            </div>
            
            <div class="project-groups-grid" id="projectGroupsContainer">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
        <div id="projectsPage" class="hidden">
            <button class="back-btn" id="backToProjectGroups">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
            </button>
            
            <header>
                <h1 id="groupTitle">Ù…Ø´Ø§Ø±ÙŠØ¹ SLY</h1>
                <p class="project-info" id="groupDetails">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© SLY ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</p>
            </header>
            
            <div class="search-container">
                <input type="text" class="search-input" id="projectSearch" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹...">
                <select class="filter-select" id="projectFilter">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</option>
                    <option value="sly">SLY</option>
                    <option value="umh">UMH</option>
                    <option value="jed">JED</option>
                    <option value="dmm">DMM</option>
                </select>
            </div>
            
            <div class="projects-grid" id="projectsContainer">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
            </div>
        </div>
        
        <!-- ØµÙØ­Ø© Ø§Ù„Ø´Ù‚Ù‚ -->
        <div id="apartmentsPage" class="hidden">
            <button class="back-btn" id="backToProjects">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
            </button>
            
            <header>
                <h1 id="projectTitle">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ SLY-1001</h1>
                <p class="project-info" id="projectDetails">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‚Ù‚: 10 - Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø±Ø¶ÙŠ ÙÙ‚Ø·</p>
            </header>
            
            <div class="search-container">
                <input type="text" class="search-input" id="apartmentSearch" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø´Ù‚Ù‚...">
                <select class="filter-select" id="apartmentFilter">
                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    <option value="available">Ù…ØªØ§Ø­Ø©</option>
                    <option value="occupied">Ù…Ø´ØºÙˆÙ„Ø©</option>
                    <option value="reserved">Ù…Ø­Ø¬ÙˆØ²Ø©</option>
                </select>
            </div>
            
            <div class="floor-section">
                <h2 class="floor-title">Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø±Ø¶ÙŠ - 10 Ø´Ù‚Ù‚</h2>
                <div class="apartments-grid" id="apartmentsContainer">
                    <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ù‚Ù‚ Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ù‚Ø© -->
        <div class="apartment-details" id="apartmentDetails">
            <div class="details-header">
                <h2 class="details-title" id="detailsTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ù‚Ø©</h2>
                <button class="close-btn" id="closeDetails">Ã—</button>
            </div>
            <div class="details-content" id="detailsContent">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let appData = {
            cities: [],
            projectGroups: {},
            projects: {},
            apartments: {},
            lastUpdate: null
        };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        async function initializeApp() {
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            const savedData = localStorage.getItem('manzilProjectsData');
            const savedTimestamp = localStorage.getItem('manzilProjectsTimestamp');
            
            if (savedData && savedTimestamp) {
                try {
                    appData = JSON.parse(savedData);
                    appData.lastUpdate = new Date(savedTimestamp);
                    showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'success');
                } catch (e) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©:', e);
                    loadDefaultData();
                }
            } else {
                loadDefaultData();
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
            checkForUpdates();
            
            // ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            initializeUI();
            
            // ØªØ³Ø¬ÙŠÙ„ Service Worker Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            registerServiceWorker();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
            setupConnectionListeners();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø§ÙØ°Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            setupInstallPrompt();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        function loadDefaultData() {
            appData.cities = [
                {
                    id: 1,
                    name: "Ø§Ù„Ø±ÙŠØ§Ø¶",
                    totalProjects: 9,
                    color: "riyadh",
                    description: "Ø§Ù„Ø¹Ø§ØµÙ…Ø© ÙˆØ£ÙƒØ¨Ø± Ù…Ø¯ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"
                },
                {
                    id: 2,
                    name: "Ø¬Ø¯Ø©", 
                    totalProjects: 6,
                    color: "jeddah",
                    description: "Ù…Ø±ÙƒØ² Ø­Ø¶Ø±ÙŠ Ø±Ø¦ÙŠØ³ÙŠ ÙˆÙ…ÙŠÙ†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±"
                },
                {
                    id: 3,
                    name: "Ø§Ù„Ø¯Ù…Ø§Ù…",
                    totalProjects: 4,
                    color: "dammam",
                    description: "Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© ÙˆÙ…Ø¯ÙŠÙ†Ø© Ù…ÙŠÙ†Ø§Ø¡ Ù…Ù‡Ù…Ø©"
                }
            ];

            appData.projectGroups = {
                riyadh: [
                    {
                        id: 1,
                        name: "SLY",
                        description: "Ù…Ø¬Ù…ÙˆØ¹Ø© SLY",
                        totalProjects: 4,
                        type: "sly"
                    },
                    {
                        id: 2,
                        name: "UMH", 
                        description: "Ù…Ø¬Ù…ÙˆØ¹Ø© UMH",
                        totalProjects: 5,
                        type: "umh"
                    }
                ],
                jeddah: [
                    {
                        id: 1,
                        name: "JED",
                        description: "Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¬Ø¯Ø©",
                        totalProjects: 3,
                        type: "jed"
                    }
                ],
                dammam: [
                    {
                        id: 1,
                        name: "DMM",
                        description: "Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¯Ù…Ø§Ù…",
                        totalProjects: 3,
                        type: "dmm"
                    }
                ]
            };

            appData.projects = {
                sly: [
                    {
                        id: 1,
                        name: "SLY-1001",
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø§Ù„Ø³Ù„ÙŠ",
                        totalApartments: 10,
                        totalBathrooms: 18
                    },
                    {
                        id: 2,
                        name: "SLY-1002", 
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø§Ù„Ø³Ù„ÙŠ",
                        totalApartments: 24,
                        totalBathrooms: 48
                    },
                    {
                        id: 3,
                        name: "SLY-1003",
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø§Ù„Ø³Ù„ÙŠ", 
                        totalApartments: 8,
                        totalBathrooms: 16
                    },
                    {
                        id: 4,
                        name: "SLY-1004",
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø§Ù„Ø³Ù„ÙŠ", 
                        totalApartments: 16,
                        totalBathrooms: 32
                    }
                ],
                umh: [
                    {
                        id: 1,
                        name: "UMH-1001",
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø£Ù… Ø§Ù„Ø­Ù…Ø§Ù…",
                        totalApartments: 12,
                        totalBathrooms: 24
                    },
                    {
                        id: 2,
                        name: "UMH-1002", 
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø£Ù… Ø§Ù„Ø­Ù…Ø§Ù…",
                        totalApartments: 18,
                        totalBathrooms: 36
                    },
                    {
                        id: 3,
                        name: "UMH-1003",
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø£Ù… Ø§Ù„Ø­Ù…Ø§Ù…", 
                        totalApartments: 14,
                        totalBathrooms: 28
                    },
                    {
                        id: 4,
                        name: "UMH-1004",
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø£Ù… Ø§Ù„Ø­Ù…Ø§Ù…", 
                        totalApartments: 20,
                        totalBathrooms: 40
                    },
                    {
                        id: 5,
                        name: "UMH-1005",
                        location: "Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø­ÙŠ Ø£Ù… Ø§Ù„Ø­Ù…Ø§Ù…", 
                        totalApartments: 16,
                        totalBathrooms: 32
                    }
                ]
            };

            appData.apartments = {
                'SLY-1001': [
                    // Ø§Ù„Ø´Ù‚Ø© 1: ØºØ±ÙØªØ§Ù† Ø¨Ø¯ÙˆÙ† Ø­Ù…Ø§Ù… - ÙƒÙ„ ØºØ±ÙØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 3 Ø£Ø³Ø±Ù‘Ø© Ù…Ø²Ø¯ÙˆØ¬Ø©
                    { 
                        id: 1, 
                        number: "SLY-1001-01", 
                        rooms: 2, 
                        bathrooms: 0, 
                        beds: 6, // 2 ØºØ±ÙØ© Ã— 3 Ø£Ø³Ø±Ù‘Ø© = 6 Ø£Ø³Ø±Ù‘Ø©
                        bedsPerRoom: 3,
                        bedType: "Ù…Ø²Ø¯ÙˆØ¬",
                        area: 80, 
                        floor: "Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø±Ø¶ÙŠ", 
                        status: "available", 
                        price: 1000000, 
                        balcony: false,
                        features: ["ØªÙƒÙŠÙŠÙ", "ØºÙŠØ± Ù…ÙØ±ÙˆØ´Ø©", "Ù…ÙˆÙ‚Ù Ø³ÙŠØ§Ø±Ø§Øª"]
                    },
                    
                    // Ø§Ù„Ø´Ù‚Ù‚ Ø§Ù„Ø£Ø®Ø±Ù‰ (2-10): 4 ØºØ±Ù ÙˆØ­Ù…Ø§Ù…Ø§Ù† - ÙƒÙ„ ØºØ±ÙØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 3 Ø£Ø³Ø±Ù‘Ø© Ù…Ø²Ø¯ÙˆØ¬Ø©
                    { 
                        id: 2, 
                        number: "SLY-1001-02", 
                        rooms: 4, 
                        bathrooms: 2, 
                        beds: 12, // 4 ØºØ±ÙØ© Ã— 3 Ø£Ø³Ø±Ù‘Ø© = 12 Ø³Ø±ÙŠØ±
                        bedsPerRoom: 3,
                        bedType: "Ù…Ø²Ø¯ÙˆØ¬",
                        area: 140, 
                        floor: "Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø±Ø¶ÙŠ", 
                        status: "available", 
                        price: 1800000, 
                        balcony: true,
                        features: ["ØªÙƒÙŠÙŠÙ", "Ù…ÙØ±ÙˆØ´Ø©", "Ù…ÙˆÙ‚Ù Ø³ÙŠØ§Ø±Ø§Øª", "Ø´Ø±ÙØ©"]
                    },
                    // ... Ø¨Ù‚ÙŠØ© Ø§Ù„Ø´Ù‚Ù‚
                ]
            };
            
            appData.lastUpdate = new Date();
            saveDataToLocalStorage();
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        function saveDataToLocalStorage() {
            localStorage.setItem('manzilProjectsData', JSON.stringify(appData));
            localStorage.setItem('manzilProjectsTimestamp', appData.lastUpdate.toISOString());
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ­Ø¯ÙŠØ«Ø§Øª
        async function checkForUpdates() {
            if (!navigator.onLine) return;
            
            try {
                document.getElementById('syncIndicator').style.display = 'flex';
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø±Ø§Ø¨Ø· Ø­Ù‚ÙŠÙ‚ÙŠ)
                const response = await fetch('/api/check-updates', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        lastUpdate: appData.lastUpdate
                    })
                }).catch(() => null); // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø®Ø§Ø¯Ù…
                
                if (response && response.ok) {
                    const updateData = await response.json();
                    if (updateData.hasUpdate) {
                        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                        applyUpdates(updateData.data);
                        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    } else {
                        showNotification('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ù„ÙØ¹Ù„', 'info');
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:', error);
            } finally {
                document.getElementById('syncIndicator').style.display = 'none';
            }
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
        function applyUpdates(updatedData) {
            // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            Object.keys(updatedData).forEach(key => {
                if (appData[key]) {
                    if (Array.isArray(appData[key])) {
                        appData[key] = [...appData[key], ...updatedData[key]];
                    } else if (typeof appData[key] === 'object') {
                        appData[key] = { ...appData[key], ...updatedData[key] };
                    } else {
                        appData[key] = updatedData[key];
                    }
                }
            });
            
            appData.lastUpdate = new Date();
            saveDataToLocalStorage();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            if (window.currentView && window.currentView.refresh) {
                window.currentView.refresh();
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Service Worker
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('Service Worker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­:', registration);
                    
                    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showNotification('ÙŠØªÙˆÙØ± ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯. Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.', 'info');
                            }
                        });
                    });
                } catch (error) {
                    console.error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker:', error);
                }
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
        function setupConnectionListeners() {
            window.addEventListener('online', () => {
                document.getElementById('offlineIndicator').style.display = 'none';
                showNotification('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success');
                checkForUpdates();
            });
            
            window.addEventListener('offline', () => {
                document.getElementById('offlineIndicator').style.display = 'block';
                showNotification('ÙÙ‚Ø¯Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'warning');
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            if (!navigator.onLine) {
                document.getElementById('offlineIndicator').style.display = 'block';
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø§ÙØ°Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function setupInstallPrompt() {
            let deferredPrompt;
            const installPrompt = document.getElementById('installPrompt');
            const installButton = document.getElementById('installButton');
            const dismissButton = document.getElementById('dismissInstall');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installPrompt.style.display = 'block';
            });
            
            installButton.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    installPrompt.style.display = 'none';
                    deferredPrompt = null;
                }
            });
            
            dismissButton.addEventListener('click', () => {
                installPrompt.style.display = 'none';
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (type === 'success') {
                notification.style.background = '#00a86b';
            } else if (type === 'warning') {
                notification.style.background = '#ff9900';
            } else if (type === 'error') {
                notification.style.background = '#ff6b6b';
            } else {
                notification.style.background = '#2a5298';
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø·ÙÙŠÙØ©)
        function initializeUI() {
            // Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø¯ÙˆØ§Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù‡Ù†Ø§
            // Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… appData Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
            
            // Ù…Ø«Ø§Ù„:
            initializeStats();
            renderCities();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ØªÙ†Ù‚Ù„
            document.getElementById('backToCities').addEventListener('click', showCitiesPage);
            document.getElementById('backToProjectGroups').addEventListener('click', () => {
                if (window.currentCity) {
                    showCityProjectGroups(window.currentCity);
                }
            });
            document.getElementById('backToProjects').addEventListener('click', () => {
                if (window.currentCity && window.currentGroup) {
                    showGroupProjects(window.currentGroup, window.currentCity.name);
                }
            });
            document.getElementById('closeDetails').addEventListener('click', () => {
                document.getElementById('apartmentDetails').style.display = 'none';
            });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function initializeStats() {
            document.getElementById('totalCities').textContent = appData.cities.length;
            
            let totalProjectsCount = 0;
            let totalApartmentsCount = 0;
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
            for (const city in appData.projectGroups) {
                appData.projectGroups[city].forEach(group => {
                    totalProjectsCount += group.totalProjects;
                });
            }
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‚Ù‚ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
            for (const group in appData.projects) {
                appData.projects[group].forEach(project => {
                    totalApartmentsCount += project.totalApartments;
                });
            }
            
            document.getElementById('totalProjects').textContent = totalProjectsCount;
            document.getElementById('totalApartments').textContent = totalApartmentsCount;
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¯Ù†
        function renderCities() {
            const citiesContainer = document.getElementById('citiesContainer');
            citiesContainer.innerHTML = '';
            
            appData.cities.forEach(city => {
                const card = document.createElement('div');
                card.className = `city-card ${city.color}-card`;
                card.dataset.id = city.id;
                
                card.innerHTML = `
                    <div class="city-name">${city.name}</div>
                    <div class="projects-count">${city.totalProjects} Ù…Ø´Ø§Ø±ÙŠØ¹</div>
                `;
                
                card.addEventListener('click', () => showCityProjectGroups(city));
                citiesContainer.appendChild(card);
            });
        }

        // Ø¹Ø±Ø¶ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
        function showCityProjectGroups(city) {
            window.currentCity = city;
            window.currentGroup = null;
            window.currentProject = null;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© ÙˆØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
            document.getElementById('cityTitle').textContent = `Ù…Ø´Ø§Ø±ÙŠØ¹ ${city.name}`;
            document.getElementById('cityDetails').textContent = `Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© ${city.name}`;
            
            // Ø¥Ø¸Ù‡Ø§Ø± ØµÙØ­Ø© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ¥Ø®ÙØ§Ø¡ ØµÙØ­Ø© Ø§Ù„Ù…Ø¯Ù†
            document.getElementById('citiesPage').classList.add('hidden');
            document.getElementById('projectGroupsPage').classList.remove('hidden');
            document.getElementById('projectsPage').classList.add('hidden');
            document.getElementById('apartmentsPage').classList.add('hidden');
            document.getElementById('apartmentDetails').style.display = 'none';
            
            // Ù…Ø³Ø­ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            const projectGroupsContainer = document.getElementById('projectGroupsContainer');
            projectGroupsContainer.innerHTML = '';
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
            const cityProjectGroups = appData.projectGroups[city.color];
            
            if (cityProjectGroups && cityProjectGroups.length > 0) {
                cityProjectGroups.forEach(group => {
                    createProjectGroupCard(group, city.name);
                });
            } else {
                projectGroupsContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <div style="font-size: 1.5rem; color: #666; margin-bottom: 10px;">
                            ğŸ—ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ØªØ§Ø­Ø©
                        </div>
                        <div style="color: #999;">
                            Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù‚Ø±ÙŠØ¨Ù‹Ø§ Ù„Ù€ ${city.name}
                        </div>
                    </div>
                `;
            }
            
            updateBreadcrumb(city);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
        function createProjectGroupCard(group, cityName) {
            const card = document.createElement('div');
            card.className = `project-group-card ${group.type}-group`;
            card.dataset.id = group.id;
            
            card.innerHTML = `
                <div class="group-name">${group.name}</div>
                <div class="group-info">${group.description}</div>
                <div class="projects-count">${group.totalProjects} Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            `;
            
            card.addEventListener('click', () => showGroupProjects(group, cityName));
            document.getElementById('projectGroupsContainer').appendChild(card);
        }

        // ... Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
        setInterval(() => {
            if (navigator.onLine) {
                checkForUpdates();
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙƒÙ„ Ø³Ø§Ø¹Ø©
setInterval(() => {
  if (navigator.onLine) {
    checkForUpdates();
  }
}, 60 * 60 * 1000); // ÙƒÙ„ Ø³Ø§Ø¹Ø©

// Ø£ÙŠØ¶Ù‹Ø§ ØªØ­Ù‚Ù‚ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', () => {
  setTimeout(() => {
    if (navigator.onLine) {
      checkForUpdates();
    }
  }, 3000);
});